{%- if include.blueprints -%}
    <h2>Blueprints</h2>
    {%- for blueprint in include.blueprints -%}
        <ul>
            <li>
                {%- capture structure_links -%}
                    {%- for structure in blueprint.structures -%}
                        {%- include link.html collection="glossary" title=structure -%},
                    {%- endfor -%}
                {%- endcapture -%}
                Craft in
                {{ structure_links | remove_last: "," | split: "," | reverse | join: "," | replace_first: ",", " or " | split: "," | reverse | join: ", " }}
                {%- if blueprint.ingredients -%}
                &nbsp;with ingredients:
                <ul>
                    {%- for ingredient in blueprint.ingredients -%}
                        <li>
                            {{ ingredient.quantity }}x&nbsp;
                            {%- capture item_links -%}
                                {%- for ingredient_name in ingredient.names -%}
                                    {%- include link.html collection="glossary" title=ingredient_name -%},
                                {%- endfor -%}
                            {%- endcapture -%}
                            {{ item_links | remove_last: "," | split: "," | reverse | join: "," | replace_first: ",", " or " | split: "," | reverse | join: ", " }}
                        </li>
                    {%- endfor -%}
                    {%- endif -%}
                </ul>
            </li>
        </ul>
    {%- endfor -%}
{%- endif -%}